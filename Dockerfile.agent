# Base: Maven + JDK 17 (official image)
FROM maven:3.9-eclipse-temurin-17

# Install tools needed by Kaniko (ca-certificates, git, etc.)
USER root
RUN apt-get update && apt-get install -y \
    ca-certificates \
    git \
    && rm -rf /var/lib/apt/lists/*

# Kaniko version
ENV KANIKO_VERSION=v1.23.0
ENV KANIKO_DIR=/kaniko

# Add Kaniko executor
RUN mkdir -p ${KANIKO_DIR} \
    && wget -q -O ${KANIKO_DIR}/executor \
       "https://github.com/GoogleContainerTools/kaniko/releases/download/${KANIKO_VERSION}/executor-linux-amd64" \
    && chmod +x ${KANIKO_DIR}/executor

# Optional: set workdir for Jenkins
WORKDIR /workspace

# Switch back to a non-root user if you prefer, but root is usually fine for CI
# USER jenkins
